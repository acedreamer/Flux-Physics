<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLUX - Two-Click Audio Capture Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0D0D0D;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            color: #00FFFF;
        }
        
        #canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        
        .demo-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00FFFF;
            border-radius: 8px;
            padding: 15px;
            max-width: 300px;
            z-index: 500;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .demo-info h4 {
            margin: 0 0 10px 0;
            color: #FFFFFF;
        }
        
        .demo-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .demo-info li {
            margin: 5px 0;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00FFFF;
            font-size: 24px;
            text-align: center;
            z-index: 1000;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-top: 3px solid #00FFFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div>Loading FLUX Two-Click Audio Test...</div>
        <div style="font-size: 14px; margin-top: 10px; opacity: 0.7;">
            Initializing enhanced audio capture system
        </div>
    </div>
    
    <div class="demo-info">
        <h4>üéµ Two-Click Audio Capture Demo</h4>
        <p><strong>How to use:</strong></p>
        <ul>
            <li>Look for the "Start Audio Visualization" button in the top-left</li>
            <li>First click shows detailed instructions</li>
            <li>Second click starts the audio capture</li>
            <li>Make sure to check "Share system audio" in the dialog!</li>
        </ul>
        <p><strong>Features:</strong></p>
        <ul>
            <li>User-friendly two-step process</li>
            <li>Clear instructions before permission request</li>
            <li>Error handling with helpful messages</li>
            <li>Seamless integration with FLUX visualizer</li>
        </ul>
    </div>

    <script type="module">
        console.log('üöÄ Starting FLUX Two-Click Audio Capture Test...')
        
        async function initializeFluxTest() {
            try {
                // Import and initialize FLUX with two-click audio
                const initFlux = await import('./src/main.js')
                const fluxApp = await initFlux.default()
                
                // Hide loading screen
                document.getElementById('loading').style.display = 'none'
                
                // Make fluxApp available globally for debugging
                window.fluxApp = fluxApp
                
                console.log('‚úÖ FLUX Two-Click Audio Test initialized successfully!')
                console.log('üéµ Look for the "Start Audio Visualization" button in the top-left corner')
                console.log('üìã The button will guide you through the audio setup process')
                
                // Show welcome message
                setTimeout(() => {
                    if (fluxApp.fluxAudioModule) {
                        fluxApp.fluxAudioModule.showToast('üéâ Two-Click Audio Capture Ready!', 'success')
                    }
                }, 2000)
                
                // Log available debugging commands
                console.log('üõ†Ô∏è Available debugging commands:')
                console.log('  - fluxApp.twoClickCapture - Access the two-click capture system')
                console.log('  - fluxApp.audioConnection - View current audio connection')
                console.log('  - fluxApp.audioState - Check audio reactive state')
                
            } catch (error) {
                console.error('‚ùå Failed to initialize FLUX Two-Click Audio Test:', error)
                
                // Show error message
                document.getElementById('loading').innerHTML = `
                    <div style="background: rgba(255, 0, 0, 0.9); padding: 30px; border-radius: 15px; max-width: 500px;">
                        <h2>‚ùå Initialization Failed</h2>
                        <p>Failed to load FLUX Two-Click Audio Test:</p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-size: 12px; text-align: left; margin: 15px 0;">${error.message}</pre>
                        <p><strong>Troubleshooting:</strong></p>
                        <ul style="text-align: left; margin: 15px 0;">
                            <li>Make sure you're running this from a web server (not file://)</li>
                            <li>Check that all files are in the correct location</li>
                            <li>Open browser console (F12) for detailed error information</li>
                            <li>Try using Chrome or Edge for best compatibility</li>
                        </ul>
                        <button onclick="location.reload()" style="background: #00FFFF; color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Retry</button>
                    </div>
                `
            }
        }
        
        // Initialize when page loads
        initializeFluxTest()
        
        // Add keyboard shortcuts for testing
        document.addEventListener('keydown', (event) => {
            if (event.key === 'a' && event.ctrlKey) {
                event.preventDefault()
                console.log('üéµ Manual audio toggle requested')
                if (window.fluxApp && window.fluxApp.twoClickCapture) {
                    // Simulate button click
                    window.fluxApp.twoClickCapture.handleClick()
                }
            }
        })
        
        console.log('üí° Press Ctrl+A to manually trigger audio capture')
    </script>
</body>
</html>