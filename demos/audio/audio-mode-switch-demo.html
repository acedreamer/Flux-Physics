<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Mode Switch Demo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        color: white;
        overflow: hidden;
      }

      .demo-container {
        position: relative;
        width: 100vw;
        height: 100vh;
      }

      .particle-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle at center,
          rgba(0, 100, 200, 0.1) 0%,
          transparent 70%
        );
      }

      .demo-info {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        max-width: 300px;
        backdrop-filter: blur(10px);
      }

      .demo-info h3 {
        margin: 0 0 15px 0;
        color: #00ffff;
        font-size: 18px;
      }

      .demo-info p {
        margin: 10px 0;
        font-size: 14px;
        line-height: 1.4;
        color: #ccc;
      }

      .demo-info .highlight {
        color: #00ff00;
        font-weight: bold;
      }

      .fake-particles {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #00ffff;
        border-radius: 50%;
        opacity: 0.7;
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
        }
      }

      .particle:nth-child(2n) {
        background: #ff00ff;
        animation-delay: -2s;
        animation-duration: 8s;
      }

      .particle:nth-child(3n) {
        background: #ffff00;
        animation-delay: -4s;
        animation-duration: 10s;
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <!-- Fake particle background -->
      <div class="fake-particles" id="particles"></div>

      <!-- Demo info panel -->
      <div class="demo-info">
        <h3>🎵 Audio Mode Switch Demo</h3>
        <p>
          This demo shows the new
          <span class="highlight">Audio Mode Switch</span> UI component.
        </p>
        <p><strong>Features:</strong></p>
        <ul
          style="
            font-size: 13px;
            color: #aaa;
            margin: 10px 0;
            padding-left: 20px;
          "
        >
          <li>Clean toggle switch design</li>
          <li>Real-time status indicators</li>
          <li>Audio level visualization</li>
          <li>Error handling with user feedback</li>
          <li>System audio + microphone support</li>
        </ul>
        <p>
          <span class="highlight">Click the toggle switch</span> in the top-left
          to enable audio reactive mode!
        </p>
      </div>
    </div>

    <script type="module">
      // Mock FluxApp for demo purposes
      class MockFluxApp {
        constructor() {
          this.config = {
            containerWidth: window.innerWidth,
            containerHeight: window.innerHeight,
          };

          this.particleRenderer = {
            audioReactiveEnabled: false,
            enableAudioReactive: () => {
              this.particleRenderer.audioReactiveEnabled = true;
              console.log("🎨 Mock particle renderer: Audio reactive enabled");
            },
            disableAudioReactive: () => {
              this.particleRenderer.audioReactiveEnabled = false;
              console.log("🎨 Mock particle renderer: Audio reactive disabled");
            },
            updateAudioColors: (hue, saturation, lightness) => {
              console.log(`🎨 Mock: Color updated to hue=${hue.toFixed(1)}`);
              this.updateParticleColors(hue);
            },
            updateBloomIntensity: (intensity) => {
              console.log(
                `💫 Mock: Bloom intensity set to ${intensity.toFixed(2)}`
              );
              this.updateBloomEffect(intensity);
            },
            applyBeatPulse: (strength) => {
              console.log(
                `💥 Mock: Beat pulse applied with strength ${strength.toFixed(
                  2
                )}`
              );
              this.triggerBeatEffect(strength);
            },
            createSparkleEffects: (intensity, count) => {
              console.log(
                `✨ Mock: Created ${count} sparkles with intensity ${intensity.toFixed(
                  2
                )}`
              );
            },
          };

          this.solver = {
            apply_force: (x, y, radius, strength) => {
              console.log(
                `🌊 Mock: Force applied at (${x.toFixed(0)}, ${y.toFixed(
                  0
                )}) with strength ${strength.toFixed(2)}`
              );
              this.createForceRipple(x, y, radius, strength);
            },
          };
        }

        updateParticleColors(hue) {
          const particles = document.querySelectorAll(".particle");
          particles.forEach((particle) => {
            particle.style.background = `hsl(${hue}, 100%, 50%)`;
          });
        }

        updateBloomEffect(intensity) {
          const particles = document.querySelectorAll(".particle");
          particles.forEach((particle) => {
            const scale = 0.5 + (intensity - 1) * 0.5;
            particle.style.transform = `scale(${scale})`;
            particle.style.boxShadow = `0 0 ${intensity * 10}px currentColor`;
          });
        }

        triggerBeatEffect(strength) {
          const particles = document.querySelectorAll(".particle");
          particles.forEach((particle, i) => {
            setTimeout(() => {
              particle.style.animation = "none";
              particle.style.transform = `scale(${1 + strength}) rotate(${
                strength * 360
              }deg)`;

              setTimeout(() => {
                particle.style.animation = "";
                particle.style.transform = "";
              }, 200);
            }, i * 50);
          });
        }

        createForceRipple(x, y, radius, strength) {
          const ripple = document.createElement("div");
          ripple.style.cssText = `
                    position: absolute;
                    left: ${x - radius}px;
                    top: ${y - radius}px;
                    width: ${radius * 2}px;
                    height: ${radius * 2}px;
                    border: 2px solid rgba(0, 255, 255, ${strength * 0.5});
                    border-radius: 50%;
                    pointer-events: none;
                    animation: ripple 1s ease-out forwards;
                `;

          document.body.appendChild(ripple);

          setTimeout(() => ripple.remove(), 1000);
        }
      }

      // Add ripple animation
      const style = document.createElement("style");
      style.textContent = `
            @keyframes ripple {
                0% { transform: scale(0); opacity: 1; }
                100% { transform: scale(2); opacity: 0; }
            }
        `;
      document.head.appendChild(style);

      // Audio Mode Switch Class (embedded for demo)
      class AudioModeSwitch {
        constructor(fluxApp, container = document.body) {
          this.fluxApp = fluxApp;
          this.container = container;
          this.audioReactive = null;
          this.isEnabled = false;
          this.switchElement = null;
          this.statusElement = null;

          this.createUI();
        }

        createUI() {
          // Remove any existing audio switch
          const existing = this.container.querySelector(".audio-mode-switch");
          if (existing) {
            existing.remove();
          }

          // Create main switch container
          const switchContainer = document.createElement("div");
          switchContainer.className = "audio-mode-switch";
          switchContainer.innerHTML = `
                    <div class="audio-switch-panel" style="
                        position: fixed;
                        top: 20px;
                        left: 20px;
                        z-index: 10000;
                        background: rgba(0, 0, 0, 0.9);
                        padding: 20px;
                        border-radius: 12px;
                        border: 2px solid #333;
                        color: white;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        min-width: 280px;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
                        backdrop-filter: blur(10px);
                        transition: all 0.3s ease;
                    ">
                        <!-- Header -->
                        <div class="switch-header" style="
                            display: flex;
                            align-items: center;
                            margin-bottom: 20px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                        ">
                            <div class="status-indicator" style="
                                width: 12px;
                                height: 12px;
                                border-radius: 50%;
                                background: #666;
                                margin-right: 12px;
                                transition: all 0.3s ease;
                                box-shadow: 0 0 0 0 rgba(102, 102, 102, 0.4);
                            "></div>
                            <h3 style="
                                margin: 0;
                                font-size: 16px;
                                font-weight: 600;
                                color: #fff;
                            ">🎵 Audio Reactive Mode</h3>
                        </div>
                        
                        <!-- Toggle Switch -->
                        <div class="toggle-container" style="
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                            margin-bottom: 20px;
                        ">
                            <span style="
                                font-size: 14px;
                                font-weight: 500;
                                color: #ccc;
                            ">Enable Audio Mode</span>
                            
                            <div class="toggle-switch" style="
                                position: relative;
                                width: 50px;
                                height: 26px;
                                background: #333;
                                border-radius: 13px;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                border: 2px solid #555;
                            ">
                                <div class="toggle-slider" style="
                                    position: absolute;
                                    top: 2px;
                                    left: 2px;
                                    width: 18px;
                                    height: 18px;
                                    background: #666;
                                    border-radius: 50%;
                                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                                "></div>
                            </div>
                        </div>
                        
                        <!-- Status Display -->
                        <div class="status-display" style="
                            background: rgba(255, 255, 255, 0.05);
                            padding: 15px;
                            border-radius: 8px;
                            border-left: 4px solid #666;
                            transition: all 0.3s ease;
                        ">
                            <div class="status-text" style="
                                font-size: 13px;
                                font-weight: 500;
                                margin-bottom: 8px;
                                color: #ccc;
                            ">
                                Status: <span class="status-value" style="color: #666;">●</span> <span class="status-label">Disabled</span>
                            </div>
                            <div class="source-text" style="
                                font-size: 12px;
                                color: #aaa;
                                margin-bottom: 8px;
                            ">
                                Source: <span class="source-value">None</span>
                            </div>
                            <div class="activity-indicator" style="
                                font-size: 11px;
                                color: #888;
                                display: none;
                            ">
                                🎵 Listening for audio...
                            </div>
                        </div>
                        
                        <!-- Audio Level Bar -->
                        <div class="audio-level-container" style="
                            margin-top: 15px;
                            display: none;
                        ">
                            <div style="
                                font-size: 11px;
                                color: #aaa;
                                margin-bottom: 5px;
                            ">Audio Level</div>
                            <div class="level-bar-bg" style="
                                height: 6px;
                                background: rgba(255, 255, 255, 0.1);
                                border-radius: 3px;
                                overflow: hidden;
                                position: relative;
                            ">
                                <div class="level-bar" style="
                                    height: 100%;
                                    width: 0%;
                                    background: linear-gradient(90deg, #00FF00 0%, #FFFF00 50%, #FF4444 100%);
                                    border-radius: 3px;
                                    transition: width 0.1s ease-out;
                                "></div>
                            </div>
                        </div>
                        
                        <!-- Instructions -->
                        <div class="instructions" style="
                            margin-top: 15px;
                            padding: 10px;
                            background: rgba(0, 150, 255, 0.1);
                            border-radius: 6px;
                            border: 1px solid rgba(0, 150, 255, 0.2);
                            font-size: 11px;
                            color: #aaa;
                            line-height: 1.4;
                        ">
                            💡 <strong>Tip:</strong> Use Chrome/Edge for system audio capture, or allow microphone access for ambient audio.
                        </div>
                    </div>
                `;

          this.container.appendChild(switchContainer);

          // Get UI elements
          this.switchElement = switchContainer.querySelector(".toggle-switch");
          this.statusElement = switchContainer.querySelector(".status-display");
          this.statusIndicator =
            switchContainer.querySelector(".status-indicator");
          this.toggleSlider = switchContainer.querySelector(".toggle-slider");
          this.statusValue = switchContainer.querySelector(".status-value");
          this.statusLabel = switchContainer.querySelector(".status-label");
          this.sourceValue = switchContainer.querySelector(".source-value");
          this.activityIndicator = switchContainer.querySelector(
            ".activity-indicator"
          );
          this.levelContainer = switchContainer.querySelector(
            ".audio-level-container"
          );
          this.levelBar = switchContainer.querySelector(".level-bar");

          // Add click handler
          this.switchElement.addEventListener("click", () =>
            this.toggleAudioMode()
          );

          // Add hover effects
          this.switchElement.addEventListener("mouseenter", () => {
            if (!this.isEnabled) {
              this.switchElement.style.borderColor = "#0099FF";
            }
          });

          this.switchElement.addEventListener("mouseleave", () => {
            if (!this.isEnabled) {
              this.switchElement.style.borderColor = "#555";
            }
          });

          console.log("🎛️ Audio Mode Switch UI created");
        }

        async toggleAudioMode() {
          console.log(
            "🔄 Audio mode toggle clicked, current state:",
            this.isEnabled
          );

          if (!this.isEnabled) {
            // Enable audio mode
            this.updateUI("enabling");

            try {
              // For demo: simulate audio reactive initialization
              await new Promise((resolve) => setTimeout(resolve, 1000));

              // Simulate successful audio setup
              this.isEnabled = true;
              this.updateUI("enabled", { source: "Demo Audio" });
              this.startLevelMonitoring();
              console.log("✅ Demo audio reactive mode enabled!");
            } catch (error) {
              this.updateUI("error", { error: error.message });
              console.error("❌ Failed to enable audio reactive:", error);
              setTimeout(() => this.updateUI("disabled"), 3000);
            }
          } else {
            // Disable audio mode
            this.isEnabled = false;
            this.stopLevelMonitoring();
            this.updateUI("disabled");
            console.log("❌ Demo audio reactive mode disabled");
          }
        }

        updateUI(state, data = {}) {
          const panel = this.container.querySelector(".audio-switch-panel");

          switch (state) {
            case "disabled":
              panel.style.borderColor = "#333";
              this.statusIndicator.style.background = "#666";
              this.statusIndicator.style.boxShadow =
                "0 0 0 0 rgba(102, 102, 102, 0.4)";
              this.switchElement.style.background = "#333";
              this.switchElement.style.borderColor = "#555";
              this.toggleSlider.style.left = "2px";
              this.toggleSlider.style.background = "#666";
              this.statusElement.style.borderLeftColor = "#666";
              this.statusValue.style.color = "#666";
              this.statusLabel.textContent = "Disabled";
              this.sourceValue.textContent = "None";
              this.activityIndicator.style.display = "none";
              this.levelContainer.style.display = "none";
              break;

            case "enabling":
              panel.style.borderColor = "#FFA500";
              this.statusIndicator.style.background = "#FFA500";
              this.statusIndicator.style.boxShadow =
                "0 0 0 4px rgba(255, 165, 0, 0.3)";
              this.statusElement.style.borderLeftColor = "#FFA500";
              this.statusValue.style.color = "#FFA500";
              this.statusLabel.textContent = "Connecting...";
              break;

            case "enabled":
              panel.style.borderColor = "#00FF00";
              this.statusIndicator.style.background = "#00FF00";
              this.statusIndicator.style.boxShadow =
                "0 0 0 4px rgba(0, 255, 0, 0.3)";
              this.switchElement.style.background = "#00AA00";
              this.switchElement.style.borderColor = "#00FF00";
              this.toggleSlider.style.left = "26px";
              this.toggleSlider.style.background = "#00FF00";
              this.statusElement.style.borderLeftColor = "#00FF00";
              this.statusValue.style.color = "#00FF00";
              this.statusLabel.textContent = "Active";
              this.sourceValue.innerHTML = `<span style="color: #00FFFF;">${
                data.source || "Unknown"
              }</span>`;
              this.activityIndicator.style.display = "block";
              this.levelContainer.style.display = "block";
              break;

            case "error":
              panel.style.borderColor = "#FF4444";
              this.statusIndicator.style.background = "#FF4444";
              this.statusIndicator.style.boxShadow =
                "0 0 0 4px rgba(255, 68, 68, 0.3)";
              this.statusElement.style.borderLeftColor = "#FF4444";
              this.statusValue.style.color = "#FF4444";
              this.statusLabel.textContent = "Error";
              this.sourceValue.innerHTML = `<span style="color: #FF4444;">${
                data.error || "Unknown error"
              }</span>`;
              break;
          }
        }

        startLevelMonitoring() {
          if (this.levelMonitorInterval) {
            clearInterval(this.levelMonitorInterval);
          }

          // Simulate audio levels for demo
          this.levelMonitorInterval = setInterval(() => {
            if (!this.isEnabled) return;

            // Generate fake audio data
            const bass = Math.random() * 0.8;
            const mids = Math.random() * 0.6;
            const treble = Math.random() * 0.4;
            const overall = (bass + mids + treble) / 3;

            // Update level bar
            const level = Math.min(overall * 100, 100);
            this.levelBar.style.width = `${level}%`;

            // Update activity indicator
            if (overall > 0.2) {
              let text = "🎵 ";
              if (bass > 0.5) text += "🔊 ";
              if (mids > 0.4) text += "🎶 ";
              if (treble > 0.3) text += "✨ ";
              text += `Demo audio (${Math.round(overall * 100)}%)`;

              this.activityIndicator.textContent = text;
              this.activityIndicator.style.color = "#00FF00";

              // Trigger visual effects
              const hue = bass * 0 + mids * 120 + treble * 240;
              this.fluxApp.particleRenderer.updateAudioColors(hue, 0.8, 0.5);
              this.fluxApp.particleRenderer.updateBloomIntensity(
                1 + overall * 2
              );

              // Random beat effects
              if (Math.random() < 0.1) {
                this.fluxApp.particleRenderer.applyBeatPulse(overall);
                this.fluxApp.solver.apply_force(
                  this.fluxApp.config.containerWidth / 2,
                  this.fluxApp.config.containerHeight / 2,
                  100,
                  overall * 2
                );
              }
            } else {
              this.activityIndicator.textContent = "🎵 Listening for audio...";
              this.activityIndicator.style.color = "#888";
            }
          }, 150);
        }

        stopLevelMonitoring() {
          if (this.levelMonitorInterval) {
            clearInterval(this.levelMonitorInterval);
            this.levelMonitorInterval = null;
          }
        }
      }

      // Setup function
      function createAudioModeSwitch(fluxApp, container = document.body) {
        const audioSwitch = new AudioModeSwitch(fluxApp, container);
        window.audioModeSwitch = audioSwitch;
        console.log("🎛️ Audio Mode Switch setup complete!");
        return audioSwitch;
      }

      // Create fake particles
      function createFakeParticles() {
        const container = document.getElementById("particles");

        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.top = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * -10 + "s";
          container.appendChild(particle);
        }
      }

      // Initialize demo
      async function initDemo() {
        console.log("🚀 Initializing Audio Mode Switch Demo...");

        // Create fake particles
        createFakeParticles();

        // Create mock FluxApp
        const mockFluxApp = new MockFluxApp();
        window.fluxApp = mockFluxApp;

        // Create audio mode switch directly (no imports needed)
        try {
          const audioSwitch = createAudioModeSwitch(mockFluxApp);

          console.log("✅ Audio Mode Switch Demo ready!");
          console.log("🎵 Click the toggle switch to test audio reactive mode");
        } catch (error) {
          console.error("❌ Failed to create audio mode switch:", error);

          // Show error message
          const errorDiv = document.createElement("div");
          errorDiv.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 20px;
                        left: 20px;
                        background: rgba(255, 0, 0, 0.9);
                        color: white;
                        padding: 20px;
                        border-radius: 10px;
                        font-family: monospace;
                        z-index: 10000;
                    ">
                        <h3>❌ Demo Error</h3>
                        <p>Failed to create audio mode switch:</p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; font-size: 12px;">${error.message}</pre>
                        <p><small>Check the browser console for more details.</small></p>
                    </div>
                `;
          document.body.appendChild(errorDiv);
        }
      }

      // Start demo when page loads
      initDemo();

      // Handle window resize
      window.addEventListener("resize", () => {
        if (window.fluxApp) {
          window.fluxApp.config.containerWidth = window.innerWidth;
          window.fluxApp.config.containerHeight = window.innerHeight;
        }
      });
    </script>
  </body>
</html>
